// *********************
// jQuery functions
// Version: 2024.10.17.1953
jQuery(function ($) {
	$(document).ready(function () {
		// Testimonial Slick Slider
		$('.testimonial_slider').slick({
			//autoplay: true,
			//autoplaySpeed: 3000,
			dots: true,
			arrows: false,
			infinite: true,
			speed: 300,
			slidesToShow: 1,
			slidesToScroll: 1,
			responsive: [
				{
					breakpoint: 767,
					settings: {
						arrows: false,
					},
				},
			],
		});

		// Show more / less Ready Class .comments-space
		$(function () {
			var moretext = 'See More';
			var lesstext = 'See Less';

			$('.comments-space').each(function () {
				var showChar = $(this).data('show-char') || 300;
				var content = $(this).clone();
				var count = 0;
				var visibleContent = $('<span class="visible_content"></span>');
				var hiddenContent = $('<span style="display:none;" class="hidden_content"></span>');
				var insidePTag = false; // A flag to track whether we are inside a <p> tag or not

				function traverseNodes(node, target) {
					$(node)
						.contents()
						.each(function () {
							if (count >= showChar && !insidePTag) {
								hiddenContent.append($(this).clone());
								return;
							}

							if (this.nodeType === 3) {
								// Text node
								count += this.nodeValue.length;

								if (count >= showChar && !insidePTag) {
									var overCount = count - showChar;
									var text = this.nodeValue;
									var endIndex = text.length - overCount;
									var showText = text.substring(0, endIndex);
									var hideText = text.substring(endIndex);

									target.append(showText.trim());
									hiddenContent.append(hideText.trim());
								} else {
									target.append(this);
								}
							} else {
								// HTML element
								var tagname = $(this).prop('tagName');
								if (tagname === 'P') {
									insidePTag = true;
								}

								var clonedNode = $(this).clone();
								clonedNode.empty();
								traverseNodes(this, clonedNode);
								target.append(clonedNode);

								if (tagname === 'P') {
									insidePTag = false;
								}
							}
						});
				}

				traverseNodes(content, visibleContent);

				// Only append the "See More" link if hidden content exists
				$(this).empty().append(visibleContent.contents()).append(hiddenContent);
				if ($.trim(hiddenContent.html()) !== '') {
					$(this).append(' <a href="" class="morelink">' + moretext + '</a>');
				}
			});

			$('.morelink').click(function () {
				if ($(this).hasClass('less')) {
					$(this).removeClass('less');
					$(this).html(moretext);
					$(this).prev().slideUp();
				} else {
					$(this).addClass('less');
					$(this).html(lesstext);
					$(this).prev().slideDown();
				}
				return false;
			});
		});

		// Animated Header == Start
		$('.iul_header_animated1 .isc_heading_group').slick({
			autoplay: true,
			autoplaySpeed: 3000,
			fade: true,
			arrows: false,
			speed: 1000,
		});

		// Function to adjust the height of the container smoothly
		function adjustContainerHeight() {
			const activePreHeading = $('.isc_pre_heading_wrap .active').length
				? $('.isc_pre_heading_wrap .active')
				: null;
			const activeMainHeading = $('.isc_heading_wrap .isc_main_heading.active');

			// Calculate the height of the active elements
			let newHeight = activeMainHeading.outerHeight(true); // Main heading height

			// Add pre-heading height only if it exists
			if (activePreHeading) {
				newHeight += activePreHeading.outerHeight(true);
			}

			// Apply the new height to the container
			$('.isc_anim_heading').height(newHeight);
		}

		// Initial height adjustment
		adjustContainerHeight();

		const preHeadingCount = $('.isc_pre_heading_wrap .isc_pre_heading').length;

		// Function to rotate pre-heading and main heading together
		setInterval(function () {
			let currentPreHeading = $('.isc_pre_heading_wrap .active');
			let currentMainHeading = $('.isc_heading_wrap .isc_main_heading.active');

			let nextPreHeading = currentPreHeading.length
				? currentPreHeading.next('.isc_pre_heading')
				: null;
			let nextMainHeading = currentMainHeading.next('.isc_main_heading');

			// Go back to the first if no next element for main heading
			if (nextMainHeading.length === 0) {
				nextMainHeading = $('.isc_heading_wrap .isc_main_heading:first');
			}

			// Animate only if there are multiple pre-headings
			if (preHeadingCount > 1) {
				// Go back to the first if no next element for pre-heading (if it exists)
				if (nextPreHeading && nextPreHeading.length === 0) {
					nextPreHeading = $('.isc_pre_heading_wrap .isc_pre_heading:first');
				}

				// Fade out current pre-heading if it exists
				if (currentPreHeading.length) {
					currentPreHeading.fadeOut(1000, function () {
						currentPreHeading.removeClass('active').css('display', 'none');

						// Fade in and move next pre-heading down by 30px if it exists
						if (nextPreHeading) {
							nextPreHeading
								.css({ top: '-30px', opacity: 0, display: 'inline-block' })
								.addClass('active')
								.animate({ opacity: 1, top: '0px' }, 1000);
						}

						adjustContainerHeight(); // Adjust container height after text change
					});
				}
			}

			// Always animate the main heading
			currentMainHeading.fadeOut(1000, function () {
				currentMainHeading.removeClass('active').css('display', 'none');
				nextMainHeading
					.css({ opacity: 0, display: 'inline-block' })
					.addClass('active')
					.animate({ opacity: 1 }, 1000);
				adjustContainerHeight(); // Adjust container height after text change
			});
		}, 5000); // Change text every 5 seconds for both pre-heading and main heading
		// Animated Header == End

		// End Document Ready
	});
});

/**
 * jQuery scroroller Plugin 1.0
 *
 * http://www.tinywall.net/
 *
 * Developers: Arun David, Boobalan
 * Copyright (c) 2014
 */

// Number Scroller Function - Start
(function ($) {
	$(window).on('load', function () {
		$(document).scrollzipInit();
		$(document).rollerInit();
	});
	$(window).on('load scroll resize', function () {
		$('.numscroller').scrollzip({
			showFunction: function () {
				numberRoller($(this).attr('data-slno'));
			},
			wholeVisible: false,
		});
	});
	$.fn.scrollzipInit = function () {
		$('body').prepend(
			"<div style='position:fixed;top:0px;left:0px;width:0;height:0;' id='scrollzipPoint'></div>"
		);
	};
	$.fn.rollerInit = function () {
		var i = 0;
		$('.numscroller').each(function () {
			i++;
			$(this).attr('data-slno', i);
			$(this).addClass('roller-title-number-' + i);
		});
	};
	$.fn.scrollzip = function (options) {
		var settings = $.extend(
			{
				showFunction: null,
				hideFunction: null,
				showShift: 0,
				wholeVisible: false,
				hideShift: 0,
			},
			options
		);
		return this.each(function (i, obj) {
			$(this).addClass('scrollzip');
			if ($.isFunction(settings.showFunction)) {
				if (
					!$(this).hasClass('isShown') &&
					$(window).outerHeight() +
						$('#scrollzipPoint').offset().top -
						settings.showShift >
						$(this).offset().top +
							(settings.wholeVisible ? $(this).outerHeight() : 0) &&
					$('#scrollzipPoint').offset().top +
						(settings.wholeVisible ? $(this).outerHeight() : 0) <
						$(this).outerHeight() + $(this).offset().top - settings.showShift
				) {
					$(this).addClass('isShown');
					settings.showFunction.call(this);
				}
			}
			if ($.isFunction(settings.hideFunction)) {
				if (
					$(this).hasClass('isShown') &&
					($(window).outerHeight() +
						$('#scrollzipPoint').offset().top -
						settings.hideShift <
						$(this).offset().top +
							(settings.wholeVisible ? $(this).outerHeight() : 0) ||
						$('#scrollzipPoint').offset().top +
							(settings.wholeVisible ? $(this).outerHeight() : 0) >
							$(this).outerHeight() + $(this).offset().top - settings.hideShift)
				) {
					$(this).removeClass('isShown');
					settings.hideFunction.call(this);
				}
			}
			return this;
		});
	};

	function numberRoller(slno) {
		var min = $('.roller-title-number-' + slno).attr('data-min');
		var max = $('.roller-title-number-' + slno).attr('data-max');
		var timediff = $('.roller-title-number-' + slno).attr('data-delay');
		var increment = $('.roller-title-number-' + slno).attr('data-increment');
		var numdiff = max - min;
		var timeout = (timediff * 1000) / numdiff;
		var commas = $('.roller-title-number-' + slno).attr('data-commas');
		numberRoll(slno, min, max, increment, timeout, commas);
	}

	function numberRoll(slno, min, max, increment, timeout, commas) {
		if (min <= max) {
			var displayValue = min;
			if (commas === 'true') {
				displayValue = addCommas(min);
			}
			$('.roller-title-number-' + slno).html(displayValue);
			min = parseInt(min) + parseInt(increment);
			setTimeout(function () {
				numberRoll(slno, min, max, increment, timeout, commas);
			}, timeout);
		} else {
			var finalValue = max;
			if (commas === 'true') {
				finalValue = addCommas(max);
			}
			$('.roller-title-number-' + slno).html(finalValue);
		}
	}

	function addCommas(number) {
		return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
	}
})(jQuery);
// Number Scroller Function - End

// *********************
// Javascript Functions

// Frequently Asked Questions (show/hide) with Accessibility Improvements - Start
document.addEventListener('DOMContentLoaded', function () {
	const faqQuestions = document.querySelectorAll('.faq_question');

	// Function to update the tabindex of links within a specific FAQ item
	function updateLinksTabIndex(container, index) {
		const links = container.querySelectorAll('a');
		links.forEach((link) => {
			link.setAttribute('tabindex', index.toString());
		});
	}

	const toggleFAQ = function () {
		const parent = this.closest('.faq_item');
		const isActive = parent.classList.toggle('active');
		const arrow = this.querySelector('.faq_arrow');

		if (isActive) {
			arrow.classList.replace('faq_down', 'faq_up');
			this.setAttribute('aria-expanded', 'true');
		} else {
			arrow.classList.replace('faq_up', 'faq_down');
			this.setAttribute('aria-expanded', 'false');
		}

		const faqAnswer = parent.querySelector('.faq_answer');
		faqAnswer.style.maxHeight = isActive ? `${faqAnswer.scrollHeight}px` : null;
		updateLinksTabIndex(parent, isActive ? 0 : -1);
	};

	// Initialize all links with tabindex="-1" when the page loads
	document.querySelectorAll('.faq_item').forEach((item) => {
		if (!item.classList.contains('active')) {
			updateLinksTabIndex(item, -1);
		}
	});

	faqQuestions.forEach((faqQuestion) => {
		faqQuestion.addEventListener('click', toggleFAQ);
		faqQuestion.addEventListener('keydown', function (event) {
			if (event.key === 'Enter') {
				toggleFAQ.call(this, event);
			}
		});
	});
});
// Frequently Asked Questions (show/hide) with Accessibility Improvements - End

// Modal Window Default == Start
document.addEventListener('DOMContentLoaded', function () {
	// Get all modal triggers
	const modalTriggers = document.querySelectorAll('.md_modal_trigger');
	// Attach click event listener to each trigger
	modalTriggers.forEach((trigger) => {
		trigger.addEventListener('click', function () {
			const modalId = this.getAttribute('data-modal');
			const modal = document.getElementById(modalId);
			openModal(modal);
		});
	});

	// Get all close buttons inside modals
	const modalCloseButtons = document.querySelectorAll('[data-modal-close]');

	// Attach click event listener to each close button
	modalCloseButtons.forEach((button) => {
		button.addEventListener('click', function () {
			const modalId = this.getAttribute('data-modal-close');
			const modal = document.getElementById(modalId);
			closeModal(modal);
		});
	});

	// Open the modal
	function openModal(modal) {
		document.body.style.overflow = 'hidden';
		modal.style.display = 'block';
		modal.setAttribute('aria-hidden', 'false');
		modal.classList.add('open'); // Add the 'open' class
		modal.focus();

		// Trap focus inside the modal
		const focusableElements = modal.querySelectorAll(
			'a[href], button, textarea, input[type="text"], input[type="radio"], input[type="checkbox"], input[type="submit"], select'
		);
		const firstFocusableElement = focusableElements[0];
		const lastFocusableElement = focusableElements[focusableElements.length - 1];

		modal.addEventListener('keydown', function (e) {
			const isTabPressed = e.key === 'Tab' || e.keyCode === 9;

			if (!isTabPressed) {
				return;
			}

			if (e.shiftKey) {
				if (document.activeElement === firstFocusableElement) {
					e.preventDefault();
					lastFocusableElement.focus();
				}
			} else {
				if (document.activeElement === lastFocusableElement) {
					e.preventDefault();
					firstFocusableElement.focus();
				}
			}
		});

		// Close the modal when the escape key is pressed
		modal.addEventListener('keydown', function (e) {
			const isEscapePressed = e.key === 'Escape' || e.keyCode === 27;

			if (isEscapePressed) {
				closeModal(modal);
			}
		});
	}

	// Functionality to close the modal when the escape key is pressed,
	// now set at the document level
	document.addEventListener('keydown', function (e) {
		const isEscapePressed = e.key === 'Escape' || e.keyCode === 27;
		const openModal = document.querySelector('.open'); // Assuming 'open' class is unique to the open modal

		if (isEscapePressed && openModal) {
			closeModal(openModal);
		}
	});

	// Close the modal
	function closeModal(modal) {
		document.body.style.overflow = '';
		modal.style.display = 'none';
		modal.setAttribute('aria-hidden', 'true');
		modal.classList.remove('open'); // Remove the 'open' class
	}
});
// Modal Window Default == End 4

// Layout Shift Fix
window.addEventListener('load', function () {
	document.querySelectorAll('.layout_shift_fix').forEach(function (el) {
		el.style.display = 'unset'; // Or 'initial', depending on your specific needs
	});
});
